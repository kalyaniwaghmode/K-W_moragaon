<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            height: 100%;
        }
        .ol-control > * {
            background-color: #404040!important;
            color: #cccccc!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #cccccc!important;
        }
        .search-layer-input-search {
            background-color: #404040!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(64, 64, 64, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        #map {
            width: 100%;
            height: 100%;
        }
        /* Description panel styles */
        #description-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #ffffff;
            color: #000000;
            font-size: 14px;
            padding: 8px 16px;
            border-top: 1px solid #ccc;
            text-align: center;
            z-index: 9999;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }
        /* Layer panel styles */
        #layer-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 220px;
            background: rgba(255,255,255,0.95);
            border: 1px solid #ccc;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 13px;
            z-index: 10000;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border-radius: 6px;
        }
        #layer-panel h3, #layer-panel h4 {
            margin: 5px 0;
            font-size: 14px;
        }
        #layer-panel select {
            width: 100%;
            padding: 4px;
            margin-top: 5px;
        }
        </style>
        <title>QGIS2Web Map</title>
    </head>
    <body>
        <!-- Layers Panel -->
        <div id="layer-panel">
            <h3>Layers</h3>
            <div id="layer-switcher"></div>

            <h4>Trees (Graduated by Crown Radius)</h4>
            <select id="tree-style">
                <option value="default">Default</option>
                <option value="low">Small Crowns (&lt; 5m)</option>
                <option value="medium">Medium Crowns (5â€“15m)</option>
                <option value="high">Large Crowns (&gt; 15m)</option>
            </select>
        </div>

        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>

        <!-- Static description panel -->
        <div id="description-panel">
            This is a Studio-III work of Kalyani Waghmode, a student of Urban Design M.Arch at KRVIA
        </div>

        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="resources/photon-geocoder-autocomplete.min.js"></script>
        <script src="layers/kalyani_plotboundaryplot_140725_2.js"></script>
        <script src="layers/kalyani_waterbodywaterway_140725_3.js"></script>
        <script src="layers/kalyani_buildingsbuilding_main_bu_4.js"></script>
        <script src="layers/kalyani_roadsroad_5.js"></script>
        <script src="layers/kalyani_vegetationtree_6.js"></script>
        <script src="layers/kalyani_neighbourhood__neighbourhood_05_7.js"></script>
        <script src="styles/kalyani_plotboundaryplot_140725_2_style.js"></script>
        <script src="styles/kalyani_waterbodywaterway_140725_3_style.js"></script>
        <script src="styles/kalyani_buildingsbuilding_main_bu_4_style.js"></script>
        <script src="styles/kalyani_roadsroad_5_style.js"></script>
        <script src="styles/kalyani_vegetationtree_6_style.js"></script>
        <script src="styles/kalyani_neighbourhood__neighbourhood_05_7_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>

        <script>
            // Add LayerSwitcher control
            var layerSwitcher = new ol.control.LayerSwitcher({
                activationMode: 'click',
                startActive: true,
                tipLabel: 'Layers',
                groupSelectStyle: 'children'
            });
            map.addControl(layerSwitcher);

            // Find the tree layer by title
            var treeLayer = layersList.find(l => l.get('title') && l.get('title').includes("kalyani_vegetation-trees"));

            function setTreeStyle(mode) {
                if (!treeLayer) return;

                treeLayer.setStyle(function(feature) {
                    var value = parseFloat(feature.get('crown_rad'));
                    var color = 'green';

                    if (mode === 'low' && value < 5) color = '#a1d99b';
                    else if (mode === 'medium' && value >= 5 && value < 15) color = '#31a354';
                    else if (mode === 'high' && value >= 15) color = '#006d2c';
                    else if (mode === 'default') color = 'green';

                    return new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 5,
                            fill: new ol.style.Fill({ color: color }),
                            stroke: new ol.style.Stroke({ color: '#333', width: 1 })
                        })
                    });
                });
            }

            // Event listener for dropdown
            document.getElementById('tree-style').addEventListener('change', function() {
                setTreeStyle(this.value);
            });

            // Initial style
            setTreeStyle('default');
        </script>
    </body>
</html>
